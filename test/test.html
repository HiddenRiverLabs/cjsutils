<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RangeUtil Test</title>
    <script type="module">
        import { RangeSet } from '../dist/rangeSet.js';
        import { Range } from '../dist/range.js';

        function runTests() {
            const results = [];
            let rangeUtil;

            function beforeEach() {
                rangeUtil = new RangeSet({});
            }

            function test(description, fn) {
                try {
                    beforeEach();
                    fn();
                    results.push({ description, passed: true });
                } catch (error) {
                    results.push({ description, passed: false, error });
                }
            }

            test('should add a range', () => {
                rangeUtil.addRange(new Range({ a: 1, b: 5 }));
                const ranges = rangeUtil.getRangesContaining(3);
                if (ranges.length !== 1 || ranges[0].a !== 1 || ranges[0].b !== 5) {
                    throw new Error(`Expected [[1, 5]], but got ${JSON.stringify(ranges)}`);
                }
            });

            test('should merge overlapping ranges', () => {
                rangeUtil.addRange(new Range({ a: 1, b: 5 }));
                rangeUtil.addRange(new Range({ a: 4, b: 10 }));
                const ranges = rangeUtil.getRangesContaining(6);
                if (ranges.length !== 1 || ranges[0].a !== 1 || ranges[0].b !== 10) {
                    throw new Error(`Expected [[1, 10]], but got ${JSON.stringify(ranges)}`);
                }
            });

            // test rangeGaps
            test('should find range gaps based on passed in start and end', () => {
                rangeUtil.addRange(new Range({ a: 1, b: 5 }));
                rangeUtil.addRange(new Range({ a: 10, b: 15 }));
                const gaps = rangeUtil.getRangeGaps(new Range({ a: 0, b: 20 }));
                console.log('bounded');
                console.log(gaps);
            });

            // test rangeGaps with unbouunded ranges
            test('should find range gaps based on passed in start and end with unbounded ranges', () => {
                rangeUtil.addRange(new Range({ a: -Infinity, b: 5 }));
                rangeUtil.addRange(new Range({ a: 10, b: Infinity }));
                const gaps = rangeUtil.getRangeGaps(new Range({ a: 0, b: 20 }));
                console.log('unbounded');
                console.log(gaps);
            });


            return results;
        }

        document.addEventListener('DOMContentLoaded', () => {
            const results = runTests();
            const ul = document.createElement('ul');
            results.forEach(result => {
                const li = document.createElement('li');
                li.textContent = result.passed ? `✔️ ${result.description}` : `❌ ${result.description}: ${result.error.message}`;
                ul.appendChild(li);
            });
            document.body.appendChild(ul);
        });
    </script>
</head>

<body>
    <h1>RangeUtil Test Results</h1>
</body>

</html>